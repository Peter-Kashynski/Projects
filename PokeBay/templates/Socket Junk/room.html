{% extends 'base.html' %} 
{% block content %}   

<div class="room-flexbox">
    <div class="message-box">  
        <div class="room-header-flexbox">
            <h2> Welcome to the Chat Room! </h2>   
            <h2> Room Code: {{code}}</h2>  
            <div class="back-to-home">
                <a href="{{ url_for('home') }}">
                    <button type="button" class="leave-room-button"> Leave Room </button>
                </a>
            </div> 
        </div>
        <div class="messages" id="messages"></div> 
        <div class="inputs"> 
            <input type="text" rows="3" placeholder="Message" name="message" id="message"/> 
            <button type="button" name="send" id="send-btn" onClick="sendMessage()"> 
                Send
            </button>
        </div>  
    </div>   
</div>



<script type="text/javascript">  
    var socketio = io();  

    const messages = document.getElementById("messages")  
    const currentUser = '{{ current_user.username }}';

    const createMessage = (name, msg, time) => { 
        const displayName = name === currentUser ? '<span style="color: red;">You</span>' : `<strong>${name}</strong>`;
        
        const content = `  
        <div class="text"> 
            <span> 
                ${displayName}: ${msg} 
            </span>  
            <span class="time"> 
                ${time} 
            </span>
        </div> 
        `;
        messages.innerHTML += content; 
    };


    socketio.on("message", (data) => {  
        const time = data.time || new Date().toLocaleString(); 
        createMessage(data.name, data.message, data.time); 
    });

    const sendMessage = () => { 
        const message = document.getElementById("message")
        if (message.value == "") return; 
        socketio.emit("message",{data: message.value}) 
        message.value = '';
    };
</script> 
{% for msg in messages %} 
<script type="text/javascript"> 
    createMessage("{{msg.name}}", "{{msg.message}}", "{{msg.time}}");
</script> 
{% endfor %}
{% endblock %}